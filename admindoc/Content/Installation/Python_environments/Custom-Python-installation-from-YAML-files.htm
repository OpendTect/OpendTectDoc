<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body>
        <MadCap:conditionalText MadCap:conditions="Default.ScreenOnly">
            <h1>Custom Python installation from YAML files</h1>
        </MadCap:conditionalText>
        <MadCap:conditionalText MadCap:conditions="Default.PrintOnly">
            <p>
            </p>
            <h3>Custom Python installation from YAML files</h3>
        </MadCap:conditionalText>
        <p>The Python environments we provide with YAML files can be installed into:</p>
        <ul>
            <li>
                <p>your own miniconda3 installation or into</p>
            </li>
            <li>
                <p>your own anaconda3 installation.</p>
            </li>
        </ul>
        <MadCap:conditionalText MadCap:conditions="Default.ScreenOnly">
            <h2>Download the OpendTect Python YAML files</h2>
        </MadCap:conditionalText>
        <MadCap:conditionalText MadCap:conditions="Default.PrintOnly">
            <h4 style="page-break-before: avoid">Download the OpendTect Python YAML files</h4>
        </MadCap:conditionalText>
        <p>Version 1.4.0 is the current version.</p>
        <p>For Linux:</p>
        <ul>
            <li>
                <p><a href="https://download.opendtect.org/relman/Python/1.4.0/odmlpython-cpu-mkl_lux64.yml">odmlpython-cpu-mkl_lux64.yml</a>
                </p>
            </li>
            <li>
                <p><a href="https://download.opendtect.org/relman/Python/1.4.0/odmlpython-cuda113_lux64.yml">odmlpython-cuda113_lux64.yml</a>
                </p>
            </li>
        </ul>
        <p>For Windows:</p>
        <ul>
            <li>
                <p><a href="https://download.opendtect.org/relman/Python/1.4.0/odmlpython-cpu-mkl_win64.yml">odmlpython-cpu-mkl_win64.yml</a>
                </p>
            </li>
            <li>
                <p><a href="https://download.opendtect.org/relman/Python/1.4.0/odmlpython-cuda113_win64.yml">odmlpython-cuda113_win64.yml</a>
                </p>
            </li>
        </ul>
        <p>The YAML files contain a list of essential packages that are needed inside the Python environment. You can choose to install either the CPU only (odmlpython-cpu-mkl) or CUDA 11 one or both.  In most cases the CUDA 11 one would be the best option so that the Machine Learning jobs can be run on the Nvidia GPU.</p>
        <MadCap:conditionalText MadCap:conditions="Default.ScreenOnly">
            <h2>Install the environments</h2>
        </MadCap:conditionalText>
        <MadCap:conditionalText MadCap:conditions="Default.PrintOnly">
            <p>
            </p>
            <h4 style="page-break-before: avoid">Install the environments</h4>
        </MadCap:conditionalText>
        <p>On Linux:</p>
        <ol>
            <li>
                <p>Open a terminal/konsole.</p>
            </li>
            <li>
                <p>Then run the following:</p>
                <ol style="list-style-type: lower-alpha;">
                    <li>
                        <p><span style="font-family: 'Courier New'; font-size: 10pt;">cd</span> conda installation directory (e.g. <span style="font-family: 'Courier New'; font-size: 10pt;">cd /home/user/Miniconda3</span>)</p>
                    </li>
                    <li>
                        <p><span style="font-family: 'Courier New'; font-size: 10pt;">cd bin</span>
                        </p>
                    </li>
                    <li>
                        <p><span style="font-family: 'Courier New'; font-size: 10pt;">bash ; source activate</span>
                        </p>
                    </li>
                    <li>
                        <p><span style="font-family: 'Courier New'; font-size: 10pt;">conda env create --file /pathto/odmlpython-cpu-mkl_lux64.yml</span>
                        </p>
                    </li>
                    <li>
                        <p><span style="font-family: 'Courier New'; font-size: 10pt;">conda env create --file /pathto/odmlpython-cuda113_lux64.yml</span>
                        </p>
                    </li>
                    <li>
                        <p>Conda will collect the packages it needs to install from the YAML file.</p>
                    </li>
                    <li>
                        <p>Then it will download and extract the packages, do the transaction and install remaining packages with pip.</p>
                    </li>
                </ol>
            </li>
        </ol>
        <p>On Windows:</p>
        <ol>
            <li>
                <p>Open the Command Prompt. Run as administrator if the Python installation directory is on a location for which the user requires administrative rights.</p>
            </li>
            <li>
                <p>Then run the following:</p>
                <ol style="list-style-type: lower-alpha;">
                    <li>
                        <p><span style="font-family: 'Courier New'; font-size: 10pt;">cd</span> conda installation directory (e.g. <span style="font-family: 'Courier New'; font-size: 10pt;">cd C:\Users\user\Miniconda3</span>)</p>
                    </li>
                    <li>
                        <p><span style="font-family: 'Courier New'; font-size: 10pt;">cd condabin</span>
                        </p>
                    </li>
                    <li>
                        <p><span style="font-family: 'Courier New'; font-size: 10pt;">activate.bat</span>
                        </p>
                    </li>
                    <li>
                        <p><span style="font-family: 'Courier New'; font-size: 10pt;">conda env create --file C:\pathto\odmlpython-cpu-mkl_win64.yml</span>
                        </p>
                    </li>
                    <li>
                        <p><span style="font-family: 'Courier New'; font-size: 10pt;">conda env create --file C:\pathto\odmlpython-cuda113_win64.yml</span>
                            <br />
                            <br />
                            <MadCap:conditionalText MadCap:conditions="Default.ScreenOnly">
                                <img src="../../Resources/Images/install-python-environments-windows.png" style="width: 1014px;height: 374px;" />
                            </MadCap:conditionalText>
                            <MadCap:conditionalText MadCap:conditions="Default.PrintOnly">
                                <img src="../../Resources/Images/install-python-environments-windows.png" style="width: 611px;height: 223px;" />
                            </MadCap:conditionalText>
                            <br /><small>Figure:&#160;Install Python environments from the YAML file on Windows</small>
                        </p>
                    </li>
                    <li>
                        <p>Conda will collect the packages it needs to install from the YAML file.</p>
                    </li>
                    <li>
                        <p>Then it will download and extract the packages, do the transaction and install remaining packages with pip.</p>
                    </li>
                    <li>
                        <p>To make the Python environments completely operational with OpendTect <MadCap:variable name="Variables.VersionNumber" />'s Machine Learning plugin it is necessary to get the cupti library on the system. The cupti library is only needed for the CUDA&#160;11 environment.</p>
                    </li>
                    <li>
                        <p>Finally inside OpendTect's <i>Set Python Settings</i> window choose the <b>Custom</b> Python environment and point it to your own miniconda3 or anaconda3 Python installation.</p>
                    </li>
                </ol>
            </li>
        </ol>
        <MadCap:conditionalText MadCap:conditions="Default.ScreenOnly">
            <h2>Cupti library</h2>
        </MadCap:conditionalText>
        <MadCap:conditionalText MadCap:conditions="Default.PrintOnly">
            <p>
            </p>
            <h4 style="page-break-before: avoid">Cupti library</h4>
        </MadCap:conditionalText>
        <p style="font-weight: normal;">For Windows there are two ways to get the cupti library:</p>
        <ol>
            <li>
                <p style="font-weight: normal;">You can download <a href="https://download.opendtect.org/relman/Python/1.4.0/extras/win64/cupti.lib">cupti.lib</a> and <a href="https://download.opendtect.org/relman/Python/1.4.0/extras/win64/cupti64_2021.1.1.dll">cupti64_2021.1.1.dll</a>.<br />Then copy them into <span style="font-family: 'Courier New'; font-size: 10pt;">odmlpython-cuda113\Library\bin</span>.</p>
            </li>
            <li>
                <p>Or you can download and install <a href="https://developer.nvidia.com/cuda-11-3-1-download-archive?target_os=Windows&amp;target_arch=x86_64&amp;target_version=10" target="_blank">CUDA&#160;Toolkit 11.3 update 1 from the Nvidia CUDA site</a>.<br />After installation add <span style="font-family: 'Courier New'; font-size: 10pt;">C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v11.3\extras\CUPTI\lib64</span> to the system or user environment variable Path.</p>
            </li>
        </ol>
        <p>For information about how to use the custom environment in OpendTect <MadCap:variable name="Variables.VersionNumber" /> please see the chapter <MadCap:conditionalText MadCap:conditions="Default.ScreenOnly"><a href="../OpendTect/Setup-Python-Settings.htm">Setup Python Settings</a></MadCap:conditionalText><MadCap:conditionalText MadCap:conditions="Default.PrintOnly"><a href="#Setup Python Settings" target="_parent">Setup Python Settings</a></MadCap:conditionalText>.</p>
        <MadCap:conditionalText MadCap:conditions="Default.ScreenOnly">
            <h2>Scipy missing DLL dependencies bug</h2>
        </MadCap:conditionalText>
        <MadCap:conditionalText MadCap:conditions="Default.PrintOnly">
            <p>
            </p>
            <h4 style="page-break-before: avoid">Scipy missing DLL dependencies bug</h4>
        </MadCap:conditionalText>
        <p>On Windows you might experience a missing DLL bug in the scipy library. When this happens the Machine Learning plugin will give an error message <i>Inadequate Python environment for Machine Learning plugin</i> and the details will show a traceback. This traceback includes a <i>FileNotFoundError: Could not find module...gfortran-win_amd64.dll</i> error.</p>
        <p>
            <img src="../../Resources/Images/install-python-environments-scipy-error-windows.png" />
            <br /><small>Figure:&#160;Python environments scipy error when installed via YAML&#160;file</small>
            <br />
        </p>
        <p>Scipy knows about this bug and the <a href="https://github.com/scipy/scipy/issues/14002" target="_blank">issue</a> can be viewed on their GitHub page.</p>
        <p>The following workaround has been tested and might also work for your Python environment:<br />Set environment variable CONDA_DLL_SEARCH_MODIFICATION_ENABLE to 1</p>
    </body>
</html>