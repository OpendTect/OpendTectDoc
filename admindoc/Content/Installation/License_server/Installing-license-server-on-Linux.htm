<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body>
        <MadCap:conditionalText MadCap:conditions="Default.ScreenOnly">
            <h1>Installing a license server on Linux</h1>
        </MadCap:conditionalText>
        <MadCap:conditionalText MadCap:conditions="Default.PrintOnly">
            <p>
            </p>
            <h3 style="page-break-before: avoid">Installing a license server on Linux</h3>
        </MadCap:conditionalText>
        <p>The FlexNet vendor package with the binaries that are needed can be downloaded from the <a href="https://dgbes.com/software/download/flexnet-vendors-packages" target="_blank">FlexNet Vendor Packages download page</a>.</p>
        <ol>
            <li>Download the <a href="https://download.opendtect.org/flexnet/dGB/v6.4-and-newer/flexnet11.19.5.0-dgb-lux64.zip" target="_blank">Linux 64 (FlexNet v11.19.5.0) zip-file</a> for OpendTect Pro &amp; dGB&#160;Plugins for OpendTect 6.4 and newer.<br /><br /></li>
            <li>Create a directory on the server that is to be used as license server for OpendTect. E.g. <code>mkdir /opt/flexlm/opendtect</code><br /><br /></li>
            <li>Unzip the zip-file in the directory that has been created in previous step.<br /><br /></li>
            <li>The zip-file has the following files:<br /><b>dgbld</b> :&#160;The dGB vendor daemon<br /><b>lmgrd</b> :&#160;The FlexNet license  manager daemon <br /><b>lmutil</b> :&#160;The FlexNet license management utilities<br /><br /></li>
            <li>The next thing that is needed is the server license file. This license file will be provided by the dGB support via support@dgbes.com.<br />Best is to place the license file in the same directory as lmgrd.<br /><br /></li>
            <li>The license file needs to be edited. Hence, open the license file with a text editor like Vim.<br /><br /></li>
            <li>In the top of the license file there is the SERVER&#160;line. The SERVER&#160;line format is:<br /><code>SERVER host hostid [port]</code><br />For example:<br /><code>SERVER myserver 123456abcdef 27005</code><br /><br />Note that if no <i>port</i> is specified then the FlexNet server will listen on the first available TCP port in the range of 27000-27009. A valid port number is any unused port number in the range of 1024 to 65535. Ports below 1024 are privileged port numbers.<br /><br />Below the SERVER&#160;line is the VENDOR line. This line tells the FlexNet license manager daemon (lmgrd) where to find the dGB vendor daemon (dgbld). <br />The VENDOR line format is:<br /><code>VENDOR dgbld full_path_to/dgbld [PORT=port]</code><br />For example<br /><code>VENDOR dgbld /opt/flexlm/opendtect/dgbld port=43454</code><br /><br />It is important that you replace on the DAEMON&#160;line <i>fullpath_to/dgbld</i> with the path to the dgbld file. In this example we will change it into:&#160;<i>/opt/flexlm/opendtect/dgbld</i> . <br /><br />Note that if <i>port</i> is not specified then the vendor daemon will listen on an ephemeral random port at run time.  A valid port number is any unused port number in the range of 1024 to 65535. Ports below 1024 are privileged port numbers.<br /><br />Save the license file.<br /><br /></li>
            <li>Ensure that the proper firewall exceptions are in place. There should be two exceptions for:<ol><li>The server TCP port, for the port specified in the license file, e.g. 27005 </li><li>The vendor daemon TCP port, for the port specified in the license file, e.g. 43454</li></ol></li>
        </ol>
        <MadCap:conditionalText MadCap:conditions="Default.ScreenOnly">
            <h2>Starting a license server</h2>
        </MadCap:conditionalText>
        <MadCap:conditionalText MadCap:conditions="Default.PrintOnly">
            <p>
            </p>
            <h4 style="page-break-before: avoid">Starting a license server</h4>
        </MadCap:conditionalText>
        <p>The license server can be started by executing commands:<br /><code>cd /opt/flexlm/opendtect<br />./lmgrd -c licensefile.lic -l dgbld_debug.log</code></p>
        <p>Please refer to the debug.log file in case of issues.</p>
        <p>To see the license server status you may run:<br /><code>./lmutil lmstat -a</code><br />You will then see the port number the server uses, the path to the license file(s) that are in use, whether the license server is up or down, how many licenses for the features are issued and in use.</p>
        <p>You may want to start the license server with crontab, e.g. add line (with crontab -e):<br /><code>@reboot /opt/flexlm/opendtect/lmgrd -c /opt/flexlm/opendtect/licensefile.lic -l /opt/flexlm/opendtect/dgbld_debug.log</code></p>
        <p>
            <br />
        </p>
        <MadCap:conditionalText MadCap:conditions="Default.ScreenOnly">
            <h2>Error messages</h2>
        </MadCap:conditionalText>
        <MadCap:conditionalText MadCap:conditions="Default.PrintOnly">
            <p>
            </p>
            <h4 style="page-break-before: avoid">Error messages</h4>
        </MadCap:conditionalText>
        <p>You may encounter error messages when starting the license server. Listed here are the most common ones and how to solve them.</p>
        <ul>
            <li>
                <p><code>./lmgrd:&#160;No such file or directory</code>
                    <br />
                    <br />This error occurs when either the file or the executable's loader is not present. To find the executable's loader run the following command:<br /><code>file lmgrd</code><br />It should show something like:<br /><code>lmgrd: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-lsb-x86-64.so.3, for GNU/Linux 2.6.18, stripped</code><br /><br /></p>
            </li>
            <li>
                <p><code>Cannot open "debug.log" as log file (-1)</code>
                    <br />
                    <br />This error message occurs if the user has not enough permissions to create the log file in the path specified. To solve this error message either become a user that has permissions to create the log file in the specified path or create it in a path where the user has sufficient permissions, e.g. in the user's home directory. Debian/Ubuntu users may want to run <code>sudo ./lmgrd -c licensefile.lic -l debug.log</code><br /></p>
            </li>
            <li>
                <p><code>license manager:&#160;can't initialize:&#160;Cannot read license file.</code>
                    <br />
                    <br />This error occurs if the user who starts the license server has no permissions to read the license file. To solve this change the owner of the license file.<br /></p>
            </li>
            <li>
                <p><code>Can't make directory /usr/tmp/.flexlm, errno: 2(No such file or directory)</code>
                    <br />
                    <br />This error message occurs if there is no /usr/tmp folder on the system. It can be solved by creating a symbolic link /usr/tmp that points to /tmp, for example run as root user:<br /><br /><code>ln -s /tmp /usr/tmp</code><br /></p>
            </li>
            <li>
                <p><code>Error getting status:&#160;Cannot find license file (-1,73:2 &#160;"No such file or directory")</code>
                    <br />
                    <br />This error message occurs when you run run <code>./lmutil lmstat -a</code>, but there is no license manager daemon running. It could be that the license manager daemon failed to start. More information can be found in the debug.log file.<br /><br /></p>
            </li>
        </ul>
        <MadCap:conditionalText MadCap:conditions="Default.ScreenOnly">
            <h2>Client installation</h2>
        </MadCap:conditionalText>
        <MadCap:conditionalText MadCap:conditions="Default.PrintOnly">
            <p>
            </p>
            <h4 style="page-break-before: avoid">Client installation</h4>
        </MadCap:conditionalText>
        <p>Please see the <MadCap:conditionalText MadCap:conditions="Default.ScreenOnly"><a href="../OpendTect/Licenses/Installing-floating-licenses.htm">installing floating licenses</a></MadCap:conditionalText><MadCap:conditionalText MadCap:conditions="Default.PrintOnly"><a href="#Installing floating licenses" target="_parent">installing floating licenses</a></MadCap:conditionalText> chapter for more information on how to instruct the client on how to borrow the license from the server.</p>
        <p>&#160;</p>
    </body>
</html>