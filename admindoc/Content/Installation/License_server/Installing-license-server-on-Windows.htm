<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body>
        <MadCap:conditionalText MadCap:conditions="Default.ScreenOnly">
            <h1>Installing a license server on Windows</h1>
        </MadCap:conditionalText>
        <MadCap:conditionalText MadCap:conditions="Default.PrintOnly">
            <p>
            </p>
            <h3>Installing a license server on Windows</h3>
        </MadCap:conditionalText>
        <p>The FlexNet vendor package with the binaries that are needed can be downloaded from the <a href="https://dgbes.com/index.php/download/flexnet-vendors-packages" target="_blank">FlexNet Vendor Packages download page</a>.</p>
        <ol>
            <li>Download the <a href="https://download.opendtect.org/flexnet/dGB/v6.4-and-newer/flexnet11.19.2.0-dgb-win64.zip" target="_blank">Windows 64 (FlexNet v11.19.2.0) zip-file</a> for OpendTect Pro &amp; dGB&#160;Plugins for OpendTect 6.4 and newer. <br /><br /></li>
            <li>Create a directory on the server that is to be used as license server for OpendTect. E.g. create the directory <i>C:\Program Files\FlexLM Licensing Server\OpendTect</i>. <br /><br /></li>
            <li>Unzip the zip-file in the directory that has been created in previous step.<br /><br /></li>
            <li>The zip-file has the following files:<br /><b>dgbld.exe</b> :&#160;The dGB vendor daemon<br /><b>lmgrd.exe</b> :&#160;The FlexNet license  manager daemon <br /><b>lmtools.exe</b> : The FlexNet LMTOOLS utility<br /><b>lmutil.exe</b> :&#160;The FlexNet license management utilities<br /><br /></li>
            <li>Ideally the log file should be written into the directory containing the lmgrd executable. Starting from FlexNet v11.17.2 this is possible on a path containing a space. If an older FlexNet version is used as license server then we advise to write the log file into folder <i>C:\ProgramData\FLEXlm\lmgrd</i>. Create this folder if it does not yet exist.<br /><br /></li>
            <li>The next thing that is needed is the server license file. This license file will be provided by the dGB support via support@dgbes.com.<br />Best is to place the license file in the same directory as lmgrd.exe. <br /><br /></li>
            <li>The license file needs to be edited. Hence, open the license file with a text editor like Notepad or Vim. <br /><br /></li>
            <li>In the top of the license file there is the SERVER&#160;line. The SERVER&#160;line format is:<br /><code>SERVER host hostid [port]</code><br />For example:<br /><code>SERVER myserver 123456abcdef 27005</code><br /><br />Note that if no port is specified then the FlexNet server will listen on the first available TCP port in the range of 27000-27009. A valid port number is any unused port number in the range of 1024 to 65535. Ports below 1024 are privileged port numbers.<br /><br />Below the SERVER&#160;line is the DAEMON line. The DAEMON&#160;line format is:<br /><code>DAEMON dgbld full_path_to/dgbld [PORT=port]</code><br />For example<br /><code>DAEMON dgbld "C:\Program Files\FlexLM Licensing Server\OpendTect\dgbld.exe" port=43454</code><br /><br />It is important that you replace on the DAEMON&#160;line <i>fullpath_to/dgbld</i> with the path to the dgbld.exe file. In this example we will change it into:&#160;<i>"C:\Program Files\FlexLM Licensing Server\OpendTect\dgbld.exe"</i> . In case there are spaces in the path then the path should be within double-quotes. <br /><br />Note that if <i>port</i> is not specified then the vendor daemon will listen on an ephemeral random port at run time.  A valid port number is any unused port number in the range of 1024 to 65535. Ports below 1024 are privileged port numbers.<br /><br />Save the license file.<br /><br /></li>
            <li>Double-click the <i>lmtools.exe</i> file. This opens the LMTOOLS utility.<br /><MadCap:conditionalText MadCap:conditions="Default.ScreenOnly"><img src="../../Resources/Images/lmtools-0.png" /></MadCap:conditionalText><MadCap:conditionalText MadCap:conditions="Default.PrintOnly"><img src="../../Resources/Images/lmtools-0.png" style="width: 520px;height: 175px;" /></MadCap:conditionalText><br /><small>Figure:&#160;contents of the FlexLM&#160;Licensing Server\OpendTect directory</small><br /><br /></li>
            <li>On <i>Service/License File</i> tab toggle on Configuration using&#160;Services and LMTOOLS ignores license file path environment variables.<br /><MadCap:conditionalText MadCap:conditions="Default.ScreenOnly"><img src="../../Resources/Images/lmtools-1.png" /></MadCap:conditionalText><MadCap:conditionalText MadCap:conditions="Default.PrintOnly"><img src="../../Resources/Images/lmtools-1.png" style="width: 669px;height: 410px;" /></MadCap:conditionalText><br /><small>Figure:&#160;LMTOOLS utility:&#160;Service/License File tab</small><br /><br /></li>
            <li>Click the Config Services tab.<br /><br /><ol type="a"><li>At <i>Service Name</i> drop down create a new service name that will manage your OpendTect Pro &amp; dGB plugins licenses. The default service name is <i>Flexlm Service 1</i>. Best is to change this into a name like <i>OpendTect-PRO License Manager</i>.<br /><br /></li><li>At <i>Path to the lmgrd.exe file</i> browse to the directory that contains the lmgrd.exe file. Select lmgrd.exe and then click button <i>Open</i>.<br /><br /></li><li>At <i>Path to the license file</i> browse to the directory that contains the license file. Select the license file and then click button <i>Open</i>.<br /><br /></li><li>At <i>Path to the debug log file</i> put in the directory in which you want to write the dgbld_debug.log file. Ideally <i>C:\Program Files\FlexLM Licensing Server\OpendTect\dgbld_debug.log</i> or <i>C:\ProgramData\FLEXlm\lmgrd\dgbld_debug.log</i>.<br /><br /></li><li>Toggle on <i>Use Services</i> and then toggle on <i>Start Server at Power Up</i>. This will make sure that the license server will start automatically at power up or reboot.<br /><MadCap:conditionalText MadCap:conditions="Default.ScreenOnly"><img src="../../Resources/Images/lmtools-2.png" /></MadCap:conditionalText><MadCap:conditionalText MadCap:conditions="Default.PrintOnly"><img src="../../Resources/Images/lmtools-2.png" style="width: 625px;height: 332px;" /></MadCap:conditionalText><br /><small>Figure:&#160;LMTOOLS utility:&#160;Config Services tab</small><br /><br /></li><li>Click button Save Service and <i>Yes</i> in the confirmation window.<br /><img src="../../Resources/Images/lmtools-3.png" /><br /><small>Figure:&#160;Save the service</small><br /><br /></li><li>LMTOOLS will show a warning window if the preferred path &lt;SystemDrive&gt;\ProgramData to store service data is not set. You get this when dgbld_debug.log is not configured in the ProgramData folder. You can ignore this when there are enough permissions to read from and write to the dgbld_debug.log file. <br /><img src="../../Resources/Images/lmtools-4.png" /><br /><small>Figure:&#160;Warning about Windows preferred path for service data</small><br /></li><br /></ol></li>
            <li>Ensure that the proper firewall exceptions are in place. There should be two exceptions (inbound application exceptions) for:<ol type="a"><li>lmgrd.exe (TCP, for the port specified in the license file, e.g. 27005 )</li><li>dgbld.exe (TCP, for the port specified in the license file, e.g. 43454)</li></ol></li>
        </ol>
        <MadCap:conditionalText MadCap:conditions="Default.ScreenOnly">
            <h2>Starting a license server</h2>
        </MadCap:conditionalText>
        <MadCap:conditionalText MadCap:conditions="Default.PrintOnly">
            <p>
            </p>
            <h4 style="page-break-before: avoid">Starting a license server</h4>
        </MadCap:conditionalText>
        <ol>
            <li>Start LMTOOLS by double-clicking the <i>lmtools.exe</i> file.<br /><br /></li>
            <li>Click the <i>Start/Stop/Reread</i> tab.<br /><br /></li>
            <li>Make sure that the correct license server is selected in the list. Then click button <i>Start Server</i>.<br /><MadCap:conditionalText MadCap:conditions="Default.ScreenOnly"><img src="../../Resources/Images/lmtools-5.png" /></MadCap:conditionalText><MadCap:conditionalText MadCap:conditions="Default.PrintOnly"><img src="../../Resources/Images/lmtools-5.png" style="width: 665px;height: 408px;" /></MadCap:conditionalText><br /><small>Figure:&#160;Starting dGB License Server</small><br /><br /></li>
            <li>It is possible that the Windows firewall or your virus scanner blocks dgbld.exe . If this is the case then you would want to add dgbld.exe to the list of Trusted Programs and/or Firewall Rules. After making this change click button <i>Start Server</i> again.<br /><br /></li>
            <li>If the license server start is successful LMTOOLS will show the message: <i>Server Start Successful</i>.<br /><br /></li>
            <li>Please refer to the debug.log file in case of issues.<br /><br />This is an indication that the dgbld vendor daemon is not able to start:<br /><code>(lmgrd) License server manager (lmgrd) startup failed:<br />(lmgrd) CreateProcess error code: 0x5 File= C:\Program Files\FlexLM Licensing Server\OpendTect\dgbld.exe<br />License server manager (lmgrd) startup failed:<br />(lmgrd) CreateProcess error code: 0x5   File= dgbld.exe</code><br /><br /></li>
        </ol>
        <MadCap:conditionalText MadCap:conditions="Default.ScreenOnly">
            <h2>Client installation</h2>
        </MadCap:conditionalText>
        <MadCap:conditionalText MadCap:conditions="Default.PrintOnly">
            <p>
            </p>
            <h4 style="page-break-before: avoid">Client installation</h4>
        </MadCap:conditionalText>
        <p>Please see the <MadCap:conditionalText MadCap:conditions="Default.ScreenOnly"><a href="../OpendTect/Licenses/Installing-floating-licenses.htm">installing floating licenses</a></MadCap:conditionalText><MadCap:conditionalText MadCap:conditions="Default.PrintOnly"><a href="#Installing floating licenses" target="_parent">installing floating licenses</a></MadCap:conditionalText> chapter for more information on how to instruct the client on how to borrow the license from the server.</p>
        <p>&#160;</p>
    </body>
</html>